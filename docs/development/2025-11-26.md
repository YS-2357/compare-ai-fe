# 2025-11-26 개발 로그

- **오늘 한 일**
  1. `requirements.txt` 백엔드 중심 정리: Streamlit은 로컬 UI 용도로 유지(`streamlit==1.51.0`), Jupyter 섹션 제거, 한글 주석 제거(ASCII만 사용).
  2. `pypdf`를 4.3.1로 낮춰 `langchain-upstage==0.7.5`의 `pypdf<5` 요구 충족.
  3. Python 3.11.9 고정 파일(`.python-version`, `runtime.txt`) 확인.
- **로컬/배포 구분**
  - 로컬 개발: BE와 FE를 한 레포에서 함께 사용(현재 `app/ui` 포함, Streamlit 로컬 테스트용).
  - 실제 웹서비스 배포: BE만 사용(uvicorn으로 FastAPI만 노출).
  - FE 레포(`compare-ai-fe`): BE 레포의 UI(`app/ui`)를 그대로 복사해 별도 서비스로 운영.
- **배포 시도**
  - Supabase(Auth), Upstash Redis(레이트리밋), Render(배포) 조합으로 빠른 배포 테스트 진행.
  - Render 배포 성공, 헬스체크 확인: `curl https://compare-ai-be.onrender.com/health` → 200 OK.
- **후속 변경**
  - `langchain-teddynote` 제거, Perplexity는 `langchain-perplexity`로 교체(PPLX_API_KEY 필수).
  - 요약에 LCEL 체인(프롬프트+파서) 적용.

## 내일 할 일 (TODO)
1) BE/FE 분리 마무리 및 함수 정리
   - `app/services/langgraph.py`가 너무 길고 `call_*` LLM 함수가 반복 → 공통화/클래스화로 정리.
2) 인증/제한 기능
   - Supabase/Upstash 연동으로 이메일=아이디/비밀번호 로그인/회원가입/비밀번호 변경, 사용자별 하루 3회 제한 적용.
3) FE 정리
   - FE 레포 업데이트(큰 변경은 없으나 현재 BE 변경사항에 맞춰 연결 확인).
- **배포/실행 메모**
  - 빌드: `pip install -r requirements.txt`
  - 실행: `uvicorn app.main:app --host 0.0.0.0 --port 8000` (클라우드에서는 `$PORT`)
  - 필수 환경변수: `SUPABASE_*`, `UPSTASH_*`, `ADMIN_BYPASS_TOKEN`, `DAILY_USAGE_LIMIT`, LLM 키들, `PYTHON_VERSION=3.11.9`
- **다음 단계**
  - LangGraph 로직 클래스화 및 LCEL 적용(프롬프트/파서 분리).
  - 프런트(Streamlit 또는 Next.js) 별도 레포(`compare-ai-fe`)에서 관리하고 백엔드 호출 연동.
  - Render 배포 후 JWT 검증/레이트리밋 동작 테스트.
