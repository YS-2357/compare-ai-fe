# λ³€κ²½ μ΄λ ¥ - 2025λ…„ 1μ›” 18μΌ

## π― μ£Όμ” λ©ν‘
FastAPIμ™€ Streamlit κΈ°λ°μ λ©€ν‹° LLM λΉ„κµ ν…μ¤νΈ μ‹μ¤ν… μ•μ •ν™” λ° ν†µμ‹  λ¬Έμ  ν•΄κ²°

## π› λ¬Έμ  μ§„λ‹¨

### λ°κ²¬λ μ£Όμ” λ¬Έμ λ“¤
1. **FastAPI β†” Streamlit ν†µμ‹  μ‹¤ν¨**
   - ν”„λ΅ νΈμ—”λ“μ—μ„ μ§λ¬Έ μ…λ ¥ μ‹ λ°±μ—”λ“μ™€ ν†µμ‹ μ΄ λμ§€ μ•λ” ν„μƒ
   - ν™κ²½λ³€μ μ „λ‹¬ μ‹¤ν¨λ΅ μΈν• URL λ¶μΌμΉ

2. **CORS μ„¤μ • λ„λ½**
   - FastAPIμ— CORS λ―Έλ“¤μ›¨μ–΄κ°€ μ„¤μ •λμ§€ μ•μ•„ ν¬λ΅μ¤ μ¤λ¦¬μ§„ μ”μ²­ μ°¨λ‹¨ κ°€λ¥μ„±

3. **LangSmith λ΅κΉ… λ―Έμ„¤μ •**
   - λ…ΈνΈλ¶ νμΌμ—μ„λ” LangSmith λ΅κΉ…μ΄ ν™μ„±ν™”λμ–΄ μμΌλ‚, ν”„λ΅λ•μ… μ½”λ“μ—λ” λ―Έμ μ©

4. **UUID v7 κ²½κ³ **
   - LangSmithκ°€ UUID v7μ„ κ¶μ¥ν•μ§€λ§ UUID v4 μ‚¬μ©μΌλ΅ μΈν• κ²½κ³  λ°μƒ

5. **Timeout λ¶€μ΅±**
   - 5κ° LLM λ³‘λ ¬ νΈμ¶ μ‹ 90μ΄ timeoutμΌλ΅λ” λ¶€μ΅± (μ‹¤μ  1~2λ¶„ μ†μ”)

6. **ν¨ν‚¤μ§€ νΈν™μ„± λ¬Έμ **
   - μ „μ—­ Python ν™κ²½μ—μ„ numpy λ²„μ „ μ¶©λλ΅ μΈν• μ‹¤ν–‰ μ‹¤ν¨
   - κ°€μƒν™κ²½ λ―Έμ‚¬μ© μ‹ λ°μƒ

## β… ν•΄κ²° λ°©μ• λ° μμ • λ‚΄μ©

### 1. CORS μ„¤μ • μ¶”κ°€ (`server.py`)
```python
from fastapi.middleware.cors import CORSMiddleware

app.add_middleware(
    CORSMiddleware,
    allow_origins=["*"],
    allow_credentials=True,
    allow_methods=["*"],
    allow_headers=["*"],
)
```
- Streamlitκ³Ό FastAPI κ°„ ν†µμ‹  ν—μ©
- λ΅μ»¬ κ°λ° ν™κ²½μ—μ„ λ¨λ“  origin ν—μ©

### 2. LangSmith λ΅κΉ… ν™μ„±ν™” (`langgraph_service.py`)
```python
from langchain_teddynote import logging

# LangSmith μ¶”μ  μ„¤μ • (λ…ΈνΈλ¶ νμΌ κΈ°μ¤€)
logging.langsmith("API-LangGraph-Test")
```
- λ…ΈνΈλ¶ νμΌ κΈ°μ¤€μΌλ΅ LangSmith λ΅κΉ… μ„¤μ • μ μ©
- ν”„λ΅μ νΈλ…: `API-LangGraph-Test`
- λ¨λ“  LLM νΈμ¶μ΄ LangSmithμ— μλ™ κΈ°λ΅λ¨

### 3. UUID v7 μ§€μ› μ¶”κ°€ (`langgraph_service.py`)
```python
# LangSmith UUID v7 μ§€μ›
try:
    from langsmith import uuid7 as create_uuid
except ImportError:
    from uuid import uuid4 as create_uuid

# μ‚¬μ©
config = RunnableConfig(
    recursion_limit=20,
    configurable={"thread_id": str(create_uuid())}
)
```
- LangSmith κ¶μ¥ UUID v7 μ‚¬μ©
- UUID v7μ΄ μ—†μΌλ©΄ UUID v4λ΅ μλ™ ν΄λ°±
- κ²½κ³  λ©”μ‹μ§€ μ κ±°

### 4. ν™κ²½λ³€μ μ „λ‹¬ κ°μ„  (`main.py`)
```python
# FastAPI URLμ„ νμΌκ³Ό ν™κ²½λ³€μ λ¨λ‘μ— μ €μ¥
config_path = Path(__file__).resolve().parent / ".fastapi_url"
config_path.write_text(fastapi_url)

# ν™κ²½λ³€μ μ„¤μ • (subprocessμ— μ „λ‹¬ν•κΈ° μ„ν•΄ os.environ μ§μ ‘ μμ •)
os.environ["FASTAPI_URL"] = fastapi_url
os.environ["STREAMLIT_SERVER_PORT"] = str(streamlit_port)
```
- `os.environ`μ„ μ§μ ‘ μμ •ν•μ—¬ subprocessμ— ν™•μ‹¤ν μ „λ‹¬
- νμΌκ³Ό ν™κ²½λ³€μ μ΄μ¤‘ μ €μ¥μΌλ΅ μ•μ •μ„± ν™•λ³΄

### 5. Timeout μ¦κ°€ λ° μ—λ¬ μ²λ¦¬ κ°μ„  (`streamlit_app.py`)
```python
# Timeout 90μ΄ β†’ 180μ΄ (3λ¶„)
response = requests.post(
    API_URL,
    json={"question": question.strip()},
    timeout=180,
    headers={"Content-Type": "application/json"}
)
```
- 5κ° LLM λ³‘λ ¬ νΈμ¶μ„ κ³ λ ¤ν•μ—¬ timeout 3λ¶„μΌλ΅ μ¦κ°€
- μ‚¬μ©μμ—κ² "5κ° LLM λ³‘λ ¬ νΈμ¶, μµλ€ 3λ¶„ μ†μ”" λ©”μ‹μ§€ ν‘μ‹
- Connection, Timeout, HTTP μ—λ¬λ³„ μƒμ„Έ λ©”μ‹μ§€ μ κ³µ

### 6. κ°€μƒν™κ²½ μ‚¬μ© κ°•μ ν™”
```bash
# μ „μ—­ Python λ€μ‹  κ°€μƒν™κ²½ Python μ‚¬μ©
.venv/Scripts/python.exe main.py
```
- numpy, scipy λ“± ν¨ν‚¤μ§€ νΈν™μ„± λ¬Έμ  ν•΄κ²°
- μμ΅΄μ„± κ²©λ¦¬λ΅ μ•μ •μ„± ν–¥μƒ

## π§ ν…μ¤νΈ κ²°κ³Ό

### ν…μ¤νΈ μ§λ¬Έ
"List all Electric/Flying type Pokemon"

### μ‘λ‹µ μ‹κ°„
- μ•½ 59μ΄ (5κ° LLM λ³‘λ ¬ νΈμ¶)

### κ° λ¨λΈ μ‘λ‹µ λΉ„κµ
| λ¨λΈ | μƒνƒ | μ •ν™•λ„ | λΉ„κ³  |
|------|------|--------|------|
| **OpenAI (GPT-5-nano)** | β… 200 | μ¤‘κ°„ | Zapdos, Emolga, Thundurus λ“± (μΌλ¶€ μ¤λ¥ ν¬ν•¨) |
| **Gemini 2.5 Flash Lite** | β… 200 | λ†’μ | μƒμ„Έ μ„¤λ…κ³Ό ν•¨κ» μ •ν™•ν• 2μΆ… μ μ‹ |
| **Anthropic Claude Haiku** | β… 200 | λ†’μ | μμ²΄ μμ •ν•λ©° μ •ν™•ν• 2μΆ… μ μ‹ |
| **Perplexity Sonar** | β… 200 | λ‚®μ | "μ΅΄μ¬ν•μ§€ μ•μ" μλ»λ μ‘λ‹µ |
| **Upstage Solar Mini** | β… 200 | λ§¤μ° λ‚®μ | μ™„μ „ν μλ»λ λ©λ΅ μ κ³µ |

### LangSmith λ΅κΉ… ν™•μΈ
- β… λ¨λ“  LLM νΈμ¶μ΄ LangSmith ν”„λ΅μ νΈμ— κΈ°λ΅λ¨
- β… ν† ν° μ‚¬μ©λ‰, μ‘λ‹µ μ‹κ°„, μ—λ¬ μƒνƒ μ¶”μ  κ°€λ¥
- β… UUID v7 κ²½κ³  ν•΄κ²°λ¨

## π“ μ„±λ¥ λ©”νΈλ¦­

- **FastAPI μ‘λ‹µ μ‹κ°„**: 59μ΄
- **Streamlit UI λ°μ‘μ„±**: μ •μƒ
- **API μ„±κ³µλ¥ **: 100% (5/5 λ¨λΈ μ‘λ‹µ)
- **μ—λ¬ μ²λ¦¬**: κ° λ¨λΈ λ…λ¦½μ μΌλ΅ μ²λ¦¬ (ν•λ‚ μ‹¤ν¨ν•΄λ„ λ‹¤λ¥Έ λ¨λΈ μ‘λ‹µ μ μ§€)

## π“ μƒμ„±λ νμΌ

```
api-test/
β”β”€β”€ README.md                           # ν”„λ΅μ νΈ μ „μ²΄ λ¬Έμ„ (μ‹ κ· μ‘μ„±)
β””β”€β”€ docs/
    β””β”€β”€ changelog/
        β””β”€β”€ 2025-11-18.md               # μ΄ νμΌ
```

## π“ λ°°μ΄ μ  λ° κ°μ„ μ‚¬ν•­

### λ°°μ΄ μ 
1. **ν™κ²½λ³€μ μ „λ‹¬**: `subprocess.run()`μ—μ„ `env` νλΌλ―Έν„°λ§μΌλ΅λ” λ¶€μ΅±, `os.environ` μ§μ ‘ μμ • ν•„μ”
2. **CORS μ„¤μ •**: FastAPIμ™€ Streamlitμ„ λ‹¤λ¥Έ ν¬νΈμ—μ„ μ‹¤ν–‰ μ‹ CORS ν•„μ
3. **LangSmith UUID**: v7λ΅ λ§μ΄κ·Έλ μ΄μ… κ¶μ¥, ν•μ„ νΈν™μ„± μ μ§€ μ„ν•΄ ν΄λ°± κµ¬ν„
4. **νƒ€μ„μ•„μ›ƒ μ„¤μ •**: λ³‘λ ¬ LLM νΈμ¶ μ‹ μ¶©λ¶„ν• μ—¬μ  ν•„μ” (μµμ† 3λ¶„)
5. **κ°€μƒν™κ²½μ μ¤‘μ”μ„±**: numpy, scipy λ“± λ°”μ΄λ„λ¦¬ ν¨ν‚¤μ§€λ” λ²„μ „ μ¶©λ λΉλ²

### ν–¥ν›„ κ°μ„  κ³„ν
1. **μ¤νΈλ¦¬λ° μ‘λ‹µ**: SSE(Server-Sent Events)λ΅ κ° λ¨λΈ μ‘λ‹µμ„ μ‹¤μ‹κ°„μΌλ΅ ν‘μ‹
2. **μΊμ‹±**: λ™μΌ μ§λ¬Έ μ¬μ”μ²­ μ‹ μΊμ‹λ μ‘λ‹µ λ°ν™
3. **λ¨λΈ μ„ νƒ μµμ…**: μ‚¬μ©μκ°€ νΉμ • λ¨λΈλ§ μ„ νƒμ μΌλ΅ νΈμ¶ κ°€λ¥ν•λ„λ΅
4. **λΉ„μ© μ¶”μ **: κ° λ¨λΈλ³„ ν† ν° μ‚¬μ©λ‰ λ° μμƒ λΉ„μ© κ³„μ‚°
5. **νμ¤ν† λ¦¬**: μ΄μ „ μ§λ¬Έ/μ‘λ‹µ κΈ°λ΅ μ €μ¥ λ° μ΅°ν κΈ°λ¥

## π”§ κ°λ° ν™κ²½

- **OS**: Windows 11
- **Python**: 3.11
- **μ£Όμ” ν¨ν‚¤μ§€**:
  - FastAPI + Uvicorn
  - Streamlit
  - LangChain + LangGraph
  - LangSmith
  - langchain-teddynote

## π‘¤ μ‘μ—…μ
- Claude Code (Anthropic)

## π“ μ°Έκ³ μ‚¬ν•­
- λ…ΈνΈλ¶ νμΌ(`notebooks/api_langgraph_test.ipynb`)μ„ κΈ°μ¤€μΌλ΅ κ°λ°
- λ…ΈνΈλ¶ νμΌμ€ μμ •ν•μ§€ μ•κ³  μ°Έμ΅°λ§ μ‚¬μ©
- λ¨λ“  μ„¤μ •(λ¨λΈλ…, LangSmith ν”„λ΅μ νΈλ… λ“±)μ€ λ…ΈνΈλ¶ κΈ°μ¤€ μ μ§€
